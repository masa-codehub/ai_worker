# 戦略的アーキテクチャ成果物としてのシステムコンテキスト図：作成、品質、およびライフサイクル管理に関する包括的ガイド

## Part 1: システムコンテキスト図の基本原則

システム開発の初期段階において、プロジェクトの成否を左右する極めて重要な成果物がシステムコンテキスト図です。この図は、単なる技術的な図面ではなく、ステークホルダー間の合意形成を促し、プロジェクトの範囲を定義し、潜在的なリスクを早期に特定するための戦略的ツールとして機能します。本パートでは、システムコンテキスト図の定義、その戦略的価値、そして構成要素と表記法に関する基礎知識を体系的に解説します。

### Section 1.1: システムコンテキスト図の定義：目的、スコープ、および戦略的価値

#### コアコンセプト

システムコンテキスト図は、システム可視化における最も高い抽象度を持つ図であり、しばしばデータフロー図（DFD）のレベル0として言及されます¹。その本質は、対象となるシステム全体を一個の「**ブラックボックス**」として捉え、そのシステムが外部環境とどのように相互作用するかを視覚的に表現することにあります⁶。内部の複雑なロジックやデータ構造は意図的に隠蔽され、システムとその外部エンティティとの間の情報のやり取り（データフロー）のみに焦点が当てられます。

#### 目的と戦略的価値

システムコンテキスト図の価値は、そのシンプルさに由来する多面的な役割にあります。

-   **スコープの定義**: プロジェクトの初期分析および要件定義フェーズにおいて、システムの境界を明確に定義し、関係者間で合意するための極めて重要なツールです¹。何がプロジェクトの「範囲内」で、何が「範囲外」なのかを視覚的に示すことで、後の工程での「**スコープクリープ**（要求の無秩序な拡大）」を防ぎ、全関係者が共通の理解を持つことを保証します。
-   **ステークホルダーとのコミュニケーション**: その単純さから、ビジネス管理者やクライアントといった非技術的なステークホルダーにとって理想的なコミュニケーションツールとなります³。彼らは技術的な詳細に圧倒されることなく、システムの目的や外部との関わりを直感的に理解できます。図は、関係者間の対話を促進するための「話のネタ」として機能し、プロジェクトの基本事項を共有する手段となります¹¹。
-   **リスクの緩和**: 開発に着手する前に、すべての外部依存関係と相互作用を可視化することで、チームは潜在的な統合の課題、セキュリティの脆弱性、その他のリスクを早期に特定できます³。例えば、連携する外部システムのAPI仕様が未確定であることや、特定のユーザーグループからの予期せぬデータ入力などがリスクとして浮かび上がります。
-   **詳細分析の基盤**: コンテキスト図は、より詳細な図、例えばレベル1のDFDやC4モデルのコンテナ図などを作成するための出発点となります⁴。まず全体像を捉え、そこから段階的に詳細化していくアプローチの第一歩を担います。

#### 図の持つ契約としての側面

システムコンテキスト図がプロジェクト初期のスコープ定義とステークホルダー間のコミュニケーションに不可欠であるという事実は、この図が単なる記述的なものではなく、むしろ規範的な役割を果たすことを示唆しています。すなわち、システムコンテキスト図は、開発チームとビジネスステークホルダーとの間の**視覚的な契約書**として機能します。この高レベルなビューに合意することは、プロジェクトのスコープ、対象ユーザー、そして外部依存関係について、両者が暗黙のうちに合意したことを意味します。

この「契約」からの逸脱は、管理されていないスコープの拡大ではなく、正式な変更要求として扱われるべきです。この視点に立つと、コンテキスト図は単なる図面から、プロジェクト管理の基盤となる成果物へと昇華します。したがって、その作成プロセスは、すべての主要なステークホルダーが参加する正式な承認イベントとして位置づけられるべきです。

### Section 1.2: コンテキスト図の解剖学：コアコンポーネントと表記法標準

システムコンテキスト図は、主に3つの単純な要素で構成されます。これらの要素を理解することは、図を正確に読み解き、作成するための第一歩です。

#### コアコンポーネントの詳細

-   **システム（プロダクト／プロセス）**: 図の中心に配置される要素で、通常は円または角丸の四角形で表現されます³。これは分析対象のシステム全体を表し、その内部の複雑性は意図的に隠蔽されます⁶。名称は「オンラインショッピングシステム」のように、システムを明確に識別できるものにします¹⁹。
-   **外部エンティティ（アクター／ターミネータ）**: システムの外部に存在し、システムと相互作用する人々、組織、または他のシステムを指します²。これらはデータの源泉（ソース）であり、宛先（シンク）でもあります。通常、四角形または長方形で表現されます³。例としては、「顧客」「決済ゲートウェイ」「メインフレームバンキングシステム」などが挙げられます¹²。
-   **データフロー**: ラベル付きの矢印で表現され、システムと外部エンティティ間で交換される情報を示します⁵。ラベルには「注文詳細」「支払い確認」のように、移動するデータの内容を簡潔に記述します¹²。データの流れは一方向または双方向の場合があります³。

#### 表記法の標準

コンテキスト図は柔軟な表記が可能ですが、その起源であるDFDの世界では、主に2つの表記法が広く知られています。

-   **Gane & Sarson記法**: プロセスを角丸の四角形、外部エンティティを長方形で表現します。
-   **Yourdon & Coad記法**: プロセスを円、外部エンティティを長方形で表現します。

現代的なツールやC4モデルのようなプラクティスでは、特定の標準に厳密に従うことよりも、明確さと理解しやすさを優先し、より簡略化された表記法が用いられる傾向にあります¹¹。重要なのは、プロジェクト内で一貫した表記法を使用し、必要であれば凡例を添えることです。

**Table 1: 主要な図記法の比較**

| コンポーネント | Gane & Sarson記法 | Yourdon & Coad記法 | 説明 |
| :--- | :--- | :--- | :--- |
| **プロセス (Process)** | ![](https://i.imgur.com/8Yv2a3p.png) | ![](https://i.imgur.com/r6b3c2o.png) | データを変換する活動や機能。コンテキスト図ではシステム全体を指す。 |
| **外部エンティティ (External Entity)** | ![](https://i.imgur.com/sN0O1mX.png) | ![](https://i.imgur.com/sN0O1mX.png) | システムの外部にあり、データを送受信する人、組織、または他のシステム。 |
| **データストア (Data Store)** | ![](https://i.imgur.com/m2iJq7o.png) | ![](https://i.imgur.com/OqD8n8t.png) | データを保持する場所（データベース、ファイルなど）。コンテキスト図には通常表示されない。 |
| **データフロー (Data Flow)** | ![](https://i.imgur.com/qE2F8gQ.png) | ![](https://i.imgur.com/qE2F8gQ.png) | コンポーネント間で移動するデータを示すラベル付きの矢印。 |

## Part 2: 高価値なコンテキスト図を作成するための体系的アプローチ

価値の高いシステムコンテキスト図を作成するには、単に図形を並べるだけでなく、準備、構築、洗練という体系的なプロセスを経ることが不可欠です。本パートでは、様々な情報源から得られた知見を統合し、準備段階から実行、そして品質向上に至るまでの一貫した方法論を提示します。

### Section 2.1: 準備フェーズ：ステークホルダー分析と情報収集

図の作成に着手する前に、その基盤となる情報を収集し、関係者との共通認識を形成する準備フェーズが極めて重要です。

-   **システムのコア機能の理解**: 最初のステップは、対象システムが何を達成すべきか、その中核となる機能は何かを明確に定義することです。これは、関連するすべてのステークホルダーとの対話を通じて行われます³。この段階でシステムの目的を簡潔に記述しておくことが、後のブレを防ぎます²³。
-   **外部エンティティの特定**: 次に、システムにデータを送信する、またはシステムからデータを受信する可能性のあるすべての人、外部システム、組織を体系的にリストアップします⁷。ユーザーインタビュー、既存システムのドキュメント分析、ビジネス要求仕様書の確認などを通じて、漏れなく洗い出すことが重要です。
-   **データフローの特定**: 特定された各外部エンティティについて、システムとどのような情報を交換するのかを具体的に明らかにします⁸。例えば、「顧客」エンティティは「注文情報」をシステムに送信し、「注文確認通知」をシステムから受信するなど、具体的なデータのやり取りを定義します。

### Section 2.2: 図の構築に関するステップバイステップガイド

情報収集が完了したら、次は実際に図を構築するフェーズに移ります。ここでは、複数のガイド³ を統合した、以下の5ステップのプロセスを推奨します。

1.  **ステップ1: システムを中心に配置する**: キャンバスの中央に、システム全体を表す円または角丸の四角形を配置します。そして、その図形にシステムの正式名称をラベル付けします³。
2.  **ステップ2: 外部エンティティを配置する**: 準備フェーズで特定した外部エンティティを、システムの周囲に長方形として配置します³。関連性の高いエンティティを近くに配置するなど、視覚的な分かりやすさを考慮すると良いでしょう。
3.  **ステップ3: データフローを描画し、ラベルを付ける**: 各エンティティとシステムを、データの流れを示す矢印で結びます。矢印の向きは、データが流れる方向を正確に示さなければなりません。双方向のやり取りがある場合は、両方向の矢印を用いるか、それぞれラベルを付けた2本の別々の矢印で表現します³。各矢印には、転送されるデータの内容を簡潔かつ明確に記述したラベルを付けます（例：「ログイン要求」）²²。
4.  **ステップ4: 明瞭性のためのレビューと洗練**: 作成した図を客観的に見直し、清潔で、読みやすく、正確であることを確認します。可能な限り線が交差しないようにレイアウトを調整します。命名規則や表記法に一貫性があるかどうかもチェックします⁸。
5.  **ステップ5: ステークホルダーによる検証**: 完成した図を、技術者からビジネス担当者まで、すべてのステークホルダーと共有し、その正確性と完全性を確認してもらいます。このフィードバックループは、図が真の「契約書」として機能するために不可欠です³。

### Section 2.3: 明瞭性、可読性、およびインパクトを確保するためのベストプラクティス

高品質なコンテキスト図を作成するためには、いくつかの重要なベストプラクティスに従う必要があります。これらは、図がその目的を最大限に達成するための指針となります⁹。

-   **高い抽象度を維持する**: システムの内部プロセス、データストア（データベースなど）、または実装の詳細は絶対に含めません。システムはあくまで一つの**ブラックボックス**として扱います¹。この原則を破ると、図の目的である「全体像の共有」が損なわれます。
-   **明確で一貫性のある命名規則を用いる**: すべての要素（システム、エンティティ、データフロー）には、曖昧さのない、内容を的確に表す名前を付けます²²。例えば、「データ」といった曖昧なラベルではなく、「顧客情報」「在庫更新データ」のように具体的に記述します。
-   **視覚的な清潔さを保つ**: 線が交差するのを避け、システムを中心とした一貫性のあるレイアウトを心がけます。目標は、見た人が瞬時に内容を理解できることです¹²。
-   **「何を」に焦点を当て、「どのように」は含めない**: 図は、何のデータが交換されるかを示し、どのように処理されるかは示しません。例えば、データフローのラベルは「ログイン要求」とし、「ユーザーがIDとパスワードを入力して送信ボタンをクリックする」といった操作の詳細を記述してはいけません。
-   **1ページに収める**: コンテキスト図は、その「一目でわかる」という性質を維持するため、常に1枚のページに収まるように作成します¹⁹。

#### 集中を促すツールとしての抽象化

コンテキスト図において「高い抽象度を維持する」というルールが繰り返し強調されるのは⁶、単に図をシンプルにするためだけではありません。これは、意図的に思考を誘導するための認知的なツールとして機能します。内部の詳細を省略することを強制することで、設計者はシステムの外部との「契約」、すなわち外部から見た振る舞いと、より大きなエコシステム内での役割にのみ集中せざるを得なくなります。

この強制的な集中こそが、スコープを定義し、非技術的な聴衆とのコミュニケーションを円滑にする上で、コンテキスト図が非常に効果的である理由です。もし詳細の記述が許されれば、議論は必然的に実装レベルの話に流れてしまい、図の本来の目的である高レベルの戦略的対話が頓挫してしまうでしょう。したがって、「内部詳細の非表示」は、価値あるコンテキスト図を作成するための最も重要な制約と言えます。

**Table 2: 高品質なコンテキスト図のためのチェックリスト**

| チェック項目 | はい/いいえ | 備考 |
| :--- | :--- | :--- |
| **1. スコープと境界** | | |
| システムは単一のプロセス（円または角丸四角形）として表現されているか？ | | |
| システムの境界外にある、相互作用するすべての外部エンティティがリストアップされているか？ | | |
| 図はシステムの内部構造（データストア、サブプロセス等）を一切表示していないか？ | | |
| **2. コンポーネントとラベル** | | |
| システム名は明確で、内容を正確に表しているか？ | | |
| すべての外部エンティティは明確にラベル付けされているか？ | | |
| すべてのデータフロー（矢印）には、交換されるデータを具体的に示すラベルが付いているか？ | | |
| 命名規則はプロジェクト全体で一貫しているか？ | | |
| **3. 明瞭性と可読性** | | |
| 図は1ページに収まっているか？ | | |
| データフローの線が不必要に交差していないか？ | | |
| 矢印の向きは、データの流れの方向を正確に示しているか？ | | |
| **4. 検証** | | |
| 技術的および非技術的なステークホルダーによってレビューされ、承認されているか？ | | |

## Part 3: 実践におけるシステムコンテキスト：ドメイン別ケーススタディ

理論的な理解を現実のプロジェクトに応用するため、本パートでは3つの異なるビジネスドメイン（Eコマース、デジタルバンキング、図書館管理）におけるシステムコンテキスト図の具体的なケーススタディを詳述します。これにより、モデルの汎用性を示し、読者が自身のプロジェクトで応用する際の具体的な参照点を提供します。

### Section 3.1: ケーススタディ：Eコマースプラットフォーム

Eコマースシステムは、顧客、管理者、そして多数の外部サービスが連携する典型的な例です。

-   **システム**: 「オンラインショッピングシステム」²⁸
-   **外部エンティティ**:
    -   顧客 (Customer): 商品を閲覧し、注文を行うユーザー。
    -   管理者 (Administrator): 商品情報や在庫、売上を管理するスタッフ。
    -   決済ゲートウェイ (Payment Gateway): クレジットカード決済などを処理する外部システム。
    -   配送業者 (Shipping Provider): 注文された商品の配送情報を連携する外部システム。
    -   商品・在庫管理システム (Product Database/Supplier System): 商品情報や在庫数を管理する、場合によっては仕入先の外部システム¹²。
-   **データフロー**:
    -   顧客 → システム: 注文情報, 顧客情報, 商品レビュー投稿
    -   システム → 顧客: 商品情報, 注文確認, 発送通知
    -   管理者 → システム: 商品登録・更新, 在庫数更新
    -   システム → 管理者: 売上レポート, 注文一覧
    -   システム ↔ 決済ゲートウェイ: 決済要求, 決済結果通知
    -   システム → 配送業者: 配送先情報, 商品リスト
    -   配送業者 → システム: 追跡番号, 配送完了通知¹²

**分析**: この例⁷ は、顧客という人間のユーザーだけでなく、決済や配送といった複数の自動化された外部システムとの相互作用を明確に示しています。プロジェクト初期にこれらの外部連携をすべて洗い出すことで、APIの統合コストやデータ形式の不整合といったリスクを特定できます。

### Section 3.2: ケーススタディ：デジタルバンキングシステム

高いセキュリティと規制遵守が求められる金融システムは、コンテキスト図がその複雑な外部環境を整理する上で非常に有効なドメインです。

-   **システム**: 「インターネットバンキングシステム」²¹
-   **外部エンティティ**:
    -   個人顧客 (Personal Banking Customer): 残高照会や振込を行う一般ユーザー。
    -   基幹勘定系システム (Mainframe Banking System): 取引記録や口座情報を保持する銀行のコアシステム。
    -   Eメールシステム (E-mail System): 取引通知などを送信するための外部システム。
    -   ATM: 現金の入出金や残高照会を行う端末。
    -   他行システム (Other Banks): 銀行間送金などで連携する他の金融機関のシステム。
    -   規制当局 (Regulatory Bodies): 取引レポートの提出先となる金融監督機関³。
-   **データフロー**:
    -   個人顧客 → システム: ログイン情報, 残高照会要求, 振込指示
    -   システム → 個人顧客: 口座残高, 取引履歴
    -   システム ↔ 基幹勘定系システム: 口座情報照会, 取引記録連携
    -   システム → Eメールシステム: 取引完了通知メール
    -   ATM → システム: 出金要求, 入金情報
    -   システム ↔ 他行システム: 銀行間振込データ
    -   システム → 規制当局: 法定帳票レポート²¹

**分析**: このケーススタディ³ は、システムが単にユーザーにサービスを提供するだけでなく、行内の基幹システムや規制当局といった、ビジネス運営に不可欠な多様なエンティティとどのように連携するかを示しています。これにより、セキュリティ要件やコンプライアンス要件がシステムの境界にどのように影響するかが明確になります。

### Section 3.3: ケーススタディ：図書館管理システム

図書館管理システムは、情報管理システムの古典的な例であり、コンテキスト図の基本原則を理解するのに適しています。

-   **システム**: 「図書館管理システム」¹
-   **外部エンティティ**:
    -   会員 (Student/Member): 図書の貸出・返却・予約を行う利用者。
    -   司書 (Librarian/Administrator): 会員情報や蔵書データを管理し、貸出・返却処理を行うスタッフ。
    -   書籍仕入先 (Book Supplier): 新規図書を発注する業者。
    -   外部図書データベース (External Book Database): ISBN情報などを照会するための外部サービス¹。
-   **データフロー**:
    -   会員 → システム: 貸出要求, 予約要求, 会員情報
    -   システム → 会員: 貸出可否, 予約完了通知, 延滞通知
    -   司書 → システム: 新規蔵書登録, 会員登録・更新, 延滞料金処理
    -   システム → 司書: 蔵書リスト, 貸出状況レポート
    -   システム → 書籍仕入先: 発注書
    -   システム ↔ 外部図書データベース: ISBN検索要求, 書誌情報³⁴

**分析**: この例¹ は、物理的なモノ（図書）の管理とデジタルな情報管理が融合したシステムを示しています。会員と司書という2つの主要なユーザーグループ（アクタ）と、システムがどのように相互作用するかを明確に区別することが、要件定義の精度を高める鍵となります。

## Part 4: 高度なフレームワークとコンテキストモデリングの進化

システムコンテキスト図は単独で存在するだけでなく、より広範なアーキテクチャ設計手法の一部として位置づけられることで、その価値を最大限に発揮します。本パートでは、コンテキスト図を現代的なアーキテクチャフレームワークであるC4モデルの中に位置づけ、他の一般的な図との比較を通じて、その役割と適用範囲を明確にします。

### Section 4.1: C4モデル：現代的アーキテクチャフレームワークにおけるコンテキスト図の位置づけ

#### C4モデルの紹介

**C4モデル**（Context, Containers, Components, Code）は、ソフトウェアアーキテクチャを可視化するための階層的なアプローチです¹⁶。地図を拡大・縮小するように、異なる抽象度でシステムを捉えることを目的としています。

#### レベル1としてのコンテキスト

システムコンテキスト図は、このC4モデルにおける最高レベルの抽象度、すなわち**レベル1（Context）**に相当します。これはシステムを俯瞰する「ズームアウト」されたビューであり、対象システムがその周囲の環境（ユーザーや他のシステム）とどのように関わっているかを示します¹⁴。

#### 階層的なドリルダウン

C4モデルの強力な点は、このシステムコンテキスト図から「ズームイン」できることにあります。レベル1のコンテキスト図から、システムの内部を構成するアプリケーションやデータストアを示す**レベル2（Container）図**へ、さらにコンテナの内部の主要なコンポーネントを示す**レベル3（Component）図**へと、段階的に詳細化していくことが可能です¹⁴。この階層構造により、高レベルで非技術的なビューから、詳細で技術的なビューまで、一貫したストーリーを持ってアーキテクチャを説明できます。

#### 「巨大な一枚図」問題の解決

従来のアーキテクチャ設計では、しばしばシステムに関わるすべてを一枚の複雑な図に詰め込もうとする試みがなされました。しかし、そのような図は情報過多となり、結局誰にも何も伝えることができないという問題に陥りがちでした。C4モデルは、この問題を解決します。まずコンテキスト図で全体像を示し、必要に応じて詳細な図へと誘導することで、それぞれの図を特定の対象者と目的に合わせた、より小さく、よりシンプルなものに保ちます。コンテキスト図は、このシステムという「地図」への必須かつ不可欠な入り口として機能するのです。このアプローチは、C4モデルの階層的な性質に関する記述から導き出されます¹⁴。

### Section 4.2: 比較分析：コンテキスト図 vs. UML図

コンテキスト図は、UML（統一モデリング言語）で定義されるいくつかの図と目的や見た目が似ているため、混同されがちです。適切なツールを適切な場面で使うために、これらの違いを明確に理解することが重要です。

#### コンテキスト図 vs. UMLユースケース図

-   **焦点の違い**: コンテキスト図の焦点は、システム全体と外部アクターとの間のデータの流れ（データフロー）です¹²。一方、UMLユースケース図の焦点は、アクターの目標とシステムの機能的要求（アクターがシステムを使って何をしたいか）にあります¹²。
-   **具体例**: コンテキスト図では「顧客」が「注文データ」を「システム」に送信すると表現します。ユースケース図では「顧客」アクターが「商品を注文する」というユースケースを実行すると表現します。両者は補完的な関係にありますが、示す対象が異なります。

#### コンテキスト図 vs. UMLコンポーネント図

-   **抽象度の違い**: コンテキスト図は、システム全体を一個の箱として捉える最も高い抽象度の図です。対照的に、UMLコンポーネント図は、システムの内部を構成する物理的または論理的なコンポーネント（ライブラリ、実行ファイル、モジュールなど）と、それらの間の依存関係やインターフェースを示します⁴⁴。
-   **関係性**: C4モデルの観点から見ると、コンポーネント図はレベル2の「コンテナ」の内部をさらに詳細に示す、レベル3のビューと見なすことができます。このように、コンテキスト図とコンポーネント図は、アーキテクチャの異なる階層を表現するものであり、競合するものではありません。

**Table 3: コンテキスト図と他のアーキテクチャ図の比較**

| 図の種類 | 主な目的 | 主な対象者 | 主要な構成要素 | 抽象度 |
| :--- | :--- | :--- | :--- | :--- |
| **システムコンテキスト図** | システムの境界と外部環境とのデータフローを定義する | ビジネスステークホルダー、プロジェクトマネージャー、アーキテクト | システム、外部エンティティ、データフロー | 最高（システム全体を1つのプロセスとして扱う） |
| **UML ユースケース図** | システムが提供すべき機能的要求をユーザー視点で定義する | ビジネスアナリスト、顧客、開発者、テスター | アクター、ユースケース、システム境界 | 高（機能の概要を示す） |
| **UML コンポーネント図** | システムの物理的・論理的な構成要素とそれらの依存関係を定義する | アーキテクト、開発者 | コンポーネント、インターフェース、依存関係 | 中〜低（システム内部の構造を示す） |

この比較¹² により、各図がソフトウェア開発ライフサイクルの異なる側面を照らし出すための、それぞれ独自の価値を持つツールであることが明らかになります。

## Part 5: 維持管理の挑戦：「生きているドキュメント」の実現

ドキュメントが直面する最大の課題は、作成された瞬間から陳腐化が始まることです。特に、迅速な変更が求められるアジャイル開発環境において、この問題は深刻です。本パートでは、静的な図面の限界を克服し、ドキュメントの品質と価値を継続的に維持するための現代的なアプローチ、「**Living Documentation**（生きているドキュメント）」と、その中核技術である「**Diagram as Code**」について深く掘り下げます。

### Section 5.1: 静的な図面の落とし穴と「Living Documentation」パラダイム

#### 問題点：ドキュメントの陳腐化

VisioやPowerPointなどのツールで手動作成された図は、静的な成果物です。これらは特定の時点のスナップショットであり、システムの変更に追随して更新されることは稀です。結果として、ドキュメントと実際のシステムとの間に乖離（「**ドキュメント・ドリフト**」）が生じ、やがてその価値と信頼性を完全に失ってしまいます⁵⁰。陳腐化したドキュメントは、もはや開発の助けになるどころか、誤解を招く有害な存在にすらなり得ます。

#### 解決策：「Living Documentation」

この問題を解決するためのアプローチが「**Living Documentation**」です⁵²。これは、ドキュメント作成を開発プロセスから分離した特別な活動としてではなく、開発プロセスそのものに統合する考え方です。ドキュメントがコードと同じ「**信頼できる唯一の情報源**（Single Source of Truth）」から生成されることで、常に正確かつ最新の状態に保たれることを目指します⁵³。

### Section 5.2: 「Diagram as Code」：技術的詳細

「Living Documentation」を実現するための具体的な技術が「**Diagram as Code**」です。

#### コアコンセプト

「Diagram as Code」とは、マウス操作で図を描く代わりに、テキストベースのドメイン固有言語（DSL: Domain-Specific Language）を用いて図の構造をコードとして記述するアプローチです³⁹。このテキストファイル（コード）をツールで処理することで、視覚的な図が自動的に生成されます。

#### 主要な利点

このアプローチは、従来の図作成手法にはない、数多くの利点をもたらします。

-   **バージョン管理**: テキストベースの定義ファイルは、アプリケーションのソースコードと同様にGitなどのバージョン管理システムで管理できます。これにより、アーキテクチャの変更履歴を追跡し、ブランチやプルリクエストを通じて変更をレビューすることが可能になります³⁸。
-   **コラボレーション**: チームメンバーは、コードレビューと同じプロセスでアーキテクチャの定義について協力し、議論することができます³⁹。
-   **自動化**: 図の生成をCI/CD（継続的インテグレーション／継続的デリバリー）パイプラインに組み込むことができます。これにより、コードの変更がマージされるたびにドキュメントが自動更新され、常に最新の状態が維持されます³⁹。
-   **一貫性と再利用性**: コードによる定義は、コンポーネントやスタイルの再利用を容易にし、複数の図にわたる一貫性を保証します⁵⁶。

#### ドキュメントの価値転換：コストから検証可能な資産へ

静的なドキュメントは、作成と維持に手作業のコストがかかり、その価値は時間とともに減衰していく、純粋なコストセンターでした。「Diagram as Code」³⁹ は、この経済的な方程式を根本から変革します。図の定義をコードベースとCI/CDパイプラインに結びつけることで⁴¹、ドキュメントは検証可能な成果物へと変わります。その正確性はもはや人間の規律に依存するのではなく、自動化されたプロセスによって保証されます。

これにより、ドキュメント作成は、ROIの低い面倒な雑務から、開発と運用を積極的に支援する、価値が高く信頼性のある、継続的に検証された資産へと生まれ変わるのです。このアプローチの採用は、単なるツールの変更ではなく、組織内におけるアーキテクチャドキュメントの役割と価値そのものを高める文化的なシフトを意味します。

### Section 5.3: 「Diagram as Code」の実装：ツールに関する実践的ガイド

「Diagram as Code」を実践するためのツールはいくつか存在します。ここでは、代表的なツールを比較し、その特徴と適用例を紹介します。

-   **Structurizr**: C4モデルの提唱者であるSimon Brown氏によって開発された、C4モデルに特化したツールセットです。DSLを用いてモデルを定義し、そこからシステムコンテキスト図を含む複数のC4ビューを生成できます⁴¹。

    *コード例 (Structurizr DSL):*
    ```dsl
    workspace "インターネットバンキングシステム" "顧客がオンラインで銀行サービスを利用するためのシステム" {
        model {
            customer = person "個人顧客" "残高照会や振込を行うユーザー"
            bankingSystem = softwareSystem "インターネットバンキングシステム" "Webブラウザを通じてサービスを提供する" {
                // ここにコンテナ定義が続く
            }
            mainframe = softwareSystem "基幹勘定系システム" "取引記録や口座情報を保持する"
            emailSystem = softwareSystem "Eメールシステム" "取引通知を送信する"

            customer -> bankingSystem "利用する"
            bankingSystem -> mainframe "口座情報を照会・更新する"
            bankingSystem -> emailSystem "通知メールを送信する"
        }
        views {
            systemContext bankingSystem "SystemContext" {
                include *
                autoLayout
            }
        }
    }
    ```
    このコード⁵⁸ は、顧客、バンキングシステム、そして連携する外部システムの関係を定義し、それらを元にシステムコンテキスト図を生成します。

-   **PlantUML**: テキスト記述から多様なUML図やその他の図を生成できる、非常に汎用性の高いオープンソースツールです。C4モデルのダイアグラムもサポートしています⁴⁷。

    *コード例 (PlantUML with C4-PlantUML):*
    ```plantuml
    @startuml
    !include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml
    Person(customer, "個人顧客", "ユーザー")
    System(bankingSystem, "インターネットバンキングシステム", "オンラインサービス")
    System_Ext(mainframe, "基幹勘定系システム", "バックエンド")
    System_Ext(emailSystem, "Eメールシステム", "通知サービス")

    Rel(customer, bankingSystem, "利用する")
    Rel(bankingSystem, mainframe, "照会・更新")
    Rel(bankingSystem, emailSystem, "メール送信")
    @enduml
    ```
    このコード⁶² も同様の図を生成しますが、よりUMLライクな構文が特徴です。

-   **Mermaid**: Markdownファイルへの埋め込みに人気のある、JavaScriptベースの軽量なツールです。GitHubやGitLabなどでネイティブにサポートされており、手軽に導入できます。C4図もサポートされています⁵⁴。

**Table 4: 「Diagram as Code」ツールの比較**

| ツール | 主な特徴 | 主なユースケース | 学習コスト | 統合性 |
| :--- | :--- | :--- | :--- | :--- |
| **Structurizr** | C4モデルに完全特化。モデルとビューの分離。有償版では高度な機能を提供。 | C4モデルを厳密に適用し、複数の整合性のある図を単一モデルから生成したい場合。 | 中（DSLとC4の概念を学習） | Javaライブラリ、CLI、Dockerイメージが提供され、CI/CDに統合しやすい。 |
| **PlantUML** | 非常に多機能。UML全般、ER図、マインドマップなど多様な図をサポート。 | 1つのツールで様々な種類の図を作成したい場合。既存のUML知識を活用したい場合。 | 低〜中（基本構文は平易だが、機能が豊富） | 多くのIDEにプラグインがあり、ConfluenceやJiraとも連携可能。 |
| **Mermaid** | 軽量で高速。Markdownとの親和性が非常に高い。手軽に始められる。 | WikiやREADME.mdなどのドキュメント内に直接、簡単な図を埋め込みたい場合。 | 低（構文がシンプル） | GitHub, GitLab, Notionなどで標準サポート。CI/CDでの画像生成も可能。 |

これらのツールの選択⁴¹ は、プロジェクトの要件、チームのスキルセット、そしてドキュメントが管理される環境によって決定されるべきです。重要なのは、手書きの図から脱却し、コードとして管理する文化を導入することです。

## Part 6: 決定版 システムコンテキストドキュメントテンプレート

これまでの議論で明らかになった原則とベストプラクティスをすべて盛り込んだ、再利用可能なシステムコンテキストドキュメントの決定版テンプレートを提示します。このテンプレートは、高品質なドキュメントを効率的に作成し、その品質を維持するための具体的な指針となります。

### Section 6.1: テンプレートの構造とガイドライン

汎用性が高く、バージョン管理システムやWikiとの親和性が良いMarkdown形式でテンプレートを構成します。

---

### システムコンテキスト: \[システム名]

#### 1. ドキュメントメタデータ

| 項目 | 内容 |
| :--- | :--- |
| **システム名** | \[対象となるシステムの正式名称] |
| **バージョン** | \[ドキュメントのバージョン番号, 例: 1.0.0] |
| **最終更新日** | |
| **作成者** | \[作成者の氏名・部署] |
| **レビューア** | \[レビューアの氏名・部署] |

#### 2. システム概要²³

#### 3. システムコンテキスト図

\[ここにシステムコンテキスト図の画像を埋め込みます。]

**図のソースコード:**

#### 4. 外部エンティティ一覧

\[図に登場するすべての外部エンティティについて、その役割と責任を詳述します。]

| エンティティ名 | 種別 (人/システム) | 説明 |
| :--- | :--- | :--- |
| \[エンティティ1の名前] | \[人 or システム] | \[このエンティティが誰で、どのような役割を担うかの説明] |
| \[エンティティ2の名前] | \[人 or システム] | \[このエンティティが何で、どのような機能を持つかの説明] |
| ... | ... | ... |

#### 5. データフロー一覧

\[図に登場するすべてのデータフローについて、その内容を詳述します。]

| フロー名 | 送信元 | 送信先 | 説明 | 主要なデータペイロード（例） |
| :--- | :--- | :--- | :--- | :--- |
| \[フロー1の名前] | \[エンティティ名] | \[システム名] | \[このデータフローの目的と内容の説明] | |
| \[フロー2の名前] | \[システム名] | \[エンティティ名] | \[このデータフローの目的と内容の説明] | \[注文番号, 合計金額, 配送予定日] |
| ... | ... | ... | ... | ... |

#### 6. 前提条件と依存関係

\[このコンテキスト図を定義する上で置かれた重要な前提条件や、外部システムへの依存関係について記述します。例：決済ゲートウェイはX社のAPI v2を利用することを前提とする。]

-   **前提条件1:** ...
-   **依存関係1:** ...

#### 7. 更新履歴

\[このドキュメントの重要な変更履歴を記録します。]

| バージョン | 更新日 | 更新者 | 変更内容の概要 |
| :--- | :--- | :--- | :--- |
| 1.0.0 | YYYY-MM-DD | \[氏名] | 初版作成 |
| ... | ... | ... | ... |

---

### Section 6.2: 注釈付きテンプレート記入例：インターネットバンキングシステム

前述のテンプレートを、Part 3で取り上げた「インターネットバンキングシステム」のケーススタディを用いて具体的に埋めていきます。これにより、テンプレートの各項目が実際にどのように活用されるかを示します。

---

### システムコンテキスト: インターネットバンキングシステム

#### 1. ドキュメントメタデータ

| 項目 | 内容 |
| :--- | :--- |
| **システム名** | インターネットバンキングシステム |
| **バージョン** | 1.0.0 |
| **最終更新日** | 2024-01-15 |
| **作成者** | アーキテクトチーム |
| **レビューア** | 金融サービス事業部、コンプライアンス部 |

*注釈: メタデータは、ドキュメントの責任範囲と鮮度を明確にするために不可欠です。*

#### 2. システム概要

本システムは、個人顧客がPCやスマートフォンのWebブラウザを通じて、自身の銀行口座の残高照会、取引履歴の確認、および振込・振替といった金融取引を、時間や場所を問わず安全に行うことを目的とする。これにより、顧客満足度の向上と、窓口業務の効率化を目指す²³。

*注釈: システムの存在意義を簡潔にまとめることで、全関係者がプロジェクトのゴールを共有できます。*

#### 3. システムコンテキスト図

![](https://i.imgur.com/example.png)

*注釈: 図は視覚的な中心です。一目でシステムの全体像が把握できるようにします。*

**図のソースコード (Structurizr DSL):**

```dsl
workspace "インターネットバンキングシステム" "顧客がオンラインで銀行サービスを利用するためのシステム" {
    model {
        customer = person "個人顧客" "残高照会や振込を行うユーザー"
        bankingSystem = softwareSystem "インターネットバンキングシステム" "Webブラウザを通じてサービスを提供する"
        mainframe = softwareSystem "基幹勘定系システム" "取引記録や口座情報を保持する"
        emailSystem = softwareSystem "Eメールシステム" "取引通知を送信する"

        customer -> bankingSystem "利用する (HTTPS)"
        bankingSystem -> mainframe "口座情報を照会・更新する (API)"
        bankingSystem -> emailSystem "通知メールを送信する (SMTP)"
    }
    views {
        systemContext bankingSystem "SystemContext" {
            include *
            autoLayout
        }
    }
}
```

*注釈: ソースコードを記載することで⁶⁰、このドキュメントが「Living Documentation」であり、誰でも最新版を生成・検証できることを示します。*

#### 4. 外部エンティティ一覧

| エンティティ名 | 種別 (人/システム) | 説明 |
| :--- | :--- | :--- |
| **個人顧客** | 人 | 当行に口座を持つ個人。本システムを利用して自身の口座にアクセスする。 |
| **基幹勘定系システム** | システム | 全ての取引記録、顧客情報、口座残高を管理する、行内の信頼できる唯一の情報源。 |
| **Eメールシステム** | システム | 顧客への通知（取引完了、重要なお知らせ等）を配信するための外部メール配信サービス。 |

*注釈: 各エンティティの役割を明確にすることで、図だけでは伝わらない背景情報を提供し、誤解を防ぎます³。*

#### 5. データフロー一覧

| フロー名 | 送信元 | 送信先 | 説明 | 主要なデータペイロード（例） |
| :--- | :--- | :--- | :--- | :--- |
| **利用する** | 個人顧客 | インターネットバンキングシステム | ログイン、残高照会、振込指示など、顧客がシステムに対して行う一連の操作。 | ログインID, パスワード, 振込先口座情報, 金額 |
| **口座情報を照会・更新する** | インターネットバンキングシステム | 基幹勘定系システム | 顧客の要求に基づき、口座残高や取引履歴を照会したり、振込処理を依頼したりする。 | 顧客ID, 口座番号, 取引種別, 取引データ |
| **通知メールを送信する** | インターネットバンキングシステム | Eメールシステム | 取引完了時などに、顧客へ通知メールの送信を依頼する。 | 宛先メールアドレス, 件名, 本文 |

*注釈: データフローをリスト化し、その内容を補足することで、システム間のインターフェース仕様をより具体的に定義する助けとなります。*

## 結論

本レポートでは、システムコンテキスト図を単なる図面としてではなく、プロジェクトの成功を導くための戦略的なアーキテクチャ成果物として捉え、その理論的背景から具体的な作成方法、品質維持のための先進的なアプローチまでを包括的に論じた。

核心となる要点は以下の三点に集約される。

1.  **戦略的価値の認識**: システムコンテキスト図の真価は、スコープを定義し、ステークホルダー間の共通理解を形成する「**視覚的な契約書**」としての役割にある。この高レベルの合意形成が、プロジェクト初期段階における方向性を決定づけ、後の手戻りやスコープの混乱を防ぐための最も効果的な手段である。
2.  **体系的な作成アプローチ**: 高品質な図は、場当たり的な作図ではなく、準備・構築・洗練・検証という体系的なプロセスを経て生まれる。特に、「**高い抽象度を維持し、内部構造を一切見せない**」という原則は、議論の焦点をシステムの外部との関わりに留め、戦略的な対話を促進するために不可欠な制約である。
3.  **持続可能性の実現**: ドキュメントの価値は、その正確性と最新性によって決まる。従来の静的な図作成手法では避けられない「**陳腐化**」の問題に対し、「**Diagram as Code**」というパラダイムは根本的な解決策を提示する。図の定義をコードとしてバージョン管理し、CI/CDパイプラインを通じて自動生成することで、ドキュメントは常に信頼できる「**生きている**」資産となり、その価値を永続的に維持することが可能となる。

結論として、効果的なシステムコンテキスト図の作成と活用は、技術的なスキルだけでなく、プロジェクト全体を俯瞰し、関係者を巻き込み、そして成果物のライフサイクル全体を見通すアーキテクトとしての視座を要求する。本レポートで提示した知識、手法、そしてテンプレートが、読者の皆様のプロジェクトにおいて、より高品質で価値の高いドキュメント文化を醸成するための一助となれば幸いである。